# ğŸ—„ï¸ Render.com Database & Secrets YÃ¶netimi

## ğŸ“Š Database YÃ¶netimi

### 1. PostgreSQL Database OluÅŸturma

#### Render Dashboard'dan:
1. **New +** â†’ **PostgreSQL**
2. **Database AyarlarÄ±:**
   ```
   Name: aslaw-db
   Database Name: aslaw
   User: aslaw_user
   Region: Frankfurt (aynÄ± region'da olmalÄ±)
   Plan: Free (512MB RAM, 1GB Storage)
   ```

#### Otomatik OluÅŸturulan Bilgiler:
```bash
# Render otomatik oluÅŸturur
Database URL: postgresql://aslaw_user:password@hostname:5432/aslaw
Internal Database URL: postgresql://aslaw_user:password@internal-hostname:5432/aslaw
External Database URL: postgresql://aslaw_user:password@external-hostname:5432/aslaw
```

### 2. Database Connection Strings

#### Production Properties GÃ¼ncellemesi:
```yaml
# application-prod.yml
spring:
  datasource:
    # Render otomatik inject eder
    url: ${DATABASE_URL}
    username: ${DATABASE_USER}
    password: ${DATABASE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    
  jpa:
    hibernate:
      ddl-auto: validate # Production'da validate kullan
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    enabled: true
```

### 3. Database EriÅŸimi

#### A) Render Dashboard'dan:
1. **Database Service** â†’ **Connect**
2. **Query Editor** ile direkt SQL Ã§alÄ±ÅŸtÄ±rabilirsiniz
3. **Metrics** sekmesinden performans izleme

#### B) External Tool'lar:
```bash
# pgAdmin, DBeaver, DataGrip iÃ§in
Host: dpg-xxxxxxxxx-a.frankfurt-postgres.render.com
Port: 5432
Database: aslaw
Username: aslaw_user
Password: <render-generated-password>
SSL Mode: Require
```

#### C) psql CLI:
```bash
# Render'dan connection string kopyalayÄ±n
psql postgresql://aslaw_user:password@hostname:5432/aslaw

# Veya environment variable kullanÄ±n
psql $DATABASE_URL
```

### 4. Database Backup & Restore

#### Otomatik Backup:
- **Free Plan:** 7 gÃ¼n backup retention
- **Paid Plan:** 30 gÃ¼n backup retention
- Render otomatik daily backup alÄ±r

#### Manuel Backup:
```bash
# pg_dump kullanarak
pg_dump $DATABASE_URL > backup.sql

# Restore
psql $DATABASE_URL < backup.sql
```

#### Render Dashboard'dan:
1. **Database Service** â†’ **Backups**
2. **Create Backup** â†’ Manuel backup
3. **Restore from Backup** â†’ Geri yÃ¼kleme

## ğŸ” Secrets & Environment Variables

### 1. Environment Variables TÃ¼rleri

#### A) Service Environment Variables:
```bash
# Web Service â†’ Environment sekmesi
SPRING_PROFILES_ACTIVE=prod
JWT_SECRET=<auto-generated-secret>
UPLOAD_PROVIDER=local
UPLOAD_DIR=/app/uploads
```

#### B) Database Connection (Otomatik):
```bash
# Render otomatik inject eder
DATABASE_URL=postgresql://...
DATABASE_USER=aslaw_user  
DATABASE_PASSWORD=<auto-generated>
```

#### C) Build-time Secrets:
```bash
# Docker build iÃ§in
GITHUB_USERNAME=fthgcr
GITHUB_TOKEN=ghp_xxxxxxxxxxxx
```

### 2. Secrets Ekleme YÃ¶ntemleri

#### A) Render Dashboard'dan:
1. **Web Service** â†’ **Environment**
2. **Add Environment Variable**
3. **Key/Value** girin
4. **Save Changes**

#### B) render.yaml ile:
```yaml
envVars:
  # Statik deÄŸerler
  - key: SPRING_PROFILES_ACTIVE
    value: prod
    
  # Auto-generated secrets
  - key: JWT_SECRET
    generateValue: true
    
  # Database'den otomatik
  - key: DATABASE_URL
    fromDatabase:
      name: aslaw-db
      property: connectionString
      
  # Manuel girmeniz gereken
  - key: GITHUB_TOKEN
    sync: false # Dashboard'dan manuel girin
```

### 3. GÃ¼venli Secret YÃ¶netimi

#### GitHub Token (Kritik):
```bash
# 1. GitHub'da token oluÅŸtur
GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens

# 2. Scope'lar
âœ… read:packages
âœ… repo (private repo iÃ§in)

# 3. Render'a ekle
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### JWT Secret:
```bash
# Render otomatik oluÅŸturur (Ã¶nerilen)
JWT_SECRET=<auto-generated-256-bit-secret>

# Veya kendi secret'Ä±nÄ±zÄ± kullanÄ±n
JWT_SECRET=myVerySecureJWTSecretKey123456789
```

#### Database Secrets:
```bash
# Render otomatik yÃ¶netir
DATABASE_URL=postgresql://user:pass@host:5432/db
DATABASE_USER=aslaw_user
DATABASE_PASSWORD=<auto-generated>
```

### 4. Production Properties GÃ¼ncellemesi

#### GÃ¼ncellenmiÅŸ application-prod.yml:
```yaml
spring:
  application:
    name: aslaw-backend
  
  datasource:
    # Render environment variables
    url: ${DATABASE_URL}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5 # Free plan iÃ§in optimize
      connection-timeout: 20000
      
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          time_zone: UTC
          
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    enabled: true
    
server:
  port: ${PORT:8080} # Render PORT variable
  
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
      
# JWT Configuration
jwt:
  secret: ${JWT_SECRET}
  expiration: 86400000 # 24 hours
  
# File Upload
upload:
  provider: ${UPLOAD_PROVIDER:local}
  local:
    directory: ${UPLOAD_DIR:/app/uploads}
  max-file-size: 10MB
  
# Logging
logging:
  level:
    com.aslaw: INFO
    org.springframework.security: WARN
    org.hibernate: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
```

## ğŸ”§ Render.yaml GÃ¼ncellemesi

```yaml
services:
  - type: web
    name: aslaw-backend
    env: docker
    dockerfilePath: ./Dockerfile
    plan: free
    region: frankfurt
    branch: main
    healthCheckPath: /actuator/health
    
    # Docker build arguments
    dockerBuildArgs:
      - key: GITHUB_USERNAME
        value: fthgcr
      - key: GITHUB_TOKEN
        fromEnvVar: GITHUB_TOKEN
    
    # Runtime environment variables
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
        
      # Database connection (otomatik)
      - key: DATABASE_URL
        fromDatabase:
          name: aslaw-db
          property: connectionString
          
      # Auto-generated secrets
      - key: JWT_SECRET
        generateValue: true
        
      # Static configuration
      - key: UPLOAD_PROVIDER
        value: local
      - key: UPLOAD_DIR
        value: /app/uploads
        
      # Manuel secrets (Dashboard'dan ekleyin)
      - key: GITHUB_TOKEN
        sync: false

databases:
  - name: aslaw-db
    databaseName: aslaw
    user: aslaw_user
    plan: free
    region: frankfurt
```

## ğŸ“‹ Deployment Checklist

### 1. Database Setup:
- [ ] PostgreSQL database oluÅŸturuldu
- [ ] Connection string'ler otomatik inject edildi
- [ ] Database migrations Ã§alÄ±ÅŸÄ±yor

### 2. Secrets Configuration:
- [ ] GitHub token eklendi
- [ ] JWT secret auto-generated
- [ ] Database credentials otomatik

### 3. Environment Variables:
- [ ] SPRING_PROFILES_ACTIVE=prod
- [ ] DATABASE_URL set edildi
- [ ] TÃ¼m required variables mevcut

### 4. Security:
- [ ] Secrets dashboard'da gizli
- [ ] Database external access kÄ±sÄ±tlÄ±
- [ ] SSL/TLS aktif

## ğŸš¨ GÃ¼venlik Best Practices

### 1. Secret Rotation:
```bash
# JWT Secret'Ä± periyodik olarak deÄŸiÅŸtirin
# GitHub Token'Ä± 90 gÃ¼nde bir yenileyin
# Database password'Ã¼ Render otomatik yÃ¶netir
```

### 2. Access Control:
```bash
# Database sadece internal network'den eriÅŸilebilir
# External access sadece gerektiÄŸinde aktif edin
# Development/Production secrets'Ä± ayÄ±rÄ±n
```

### 3. Monitoring:
```bash
# Render Dashboard â†’ Metrics
# Database connection pool monitoring
# Failed authentication attempts
```

## ğŸ” Troubleshooting

### Database Connection Issues:
```bash
# 1. Connection string'i kontrol edin
echo $DATABASE_URL

# 2. Database service'in UP olduÄŸunu kontrol edin
# 3. Region'larÄ±n aynÄ± olduÄŸunu doÄŸrulayÄ±n
# 4. Firewall rules kontrol edin
```

### Secret Issues:
```bash
# 1. Environment variables'larÄ± kontrol edin
# 2. Case-sensitive olduÄŸunu unutmayÄ±n
# 3. Special characters'larÄ± escape edin
# 4. Redeploy yapÄ±n (secrets deÄŸiÅŸtiÄŸinde)
```

---

âœ… **Bu rehberle:**
- Database'i gÃ¼venli ÅŸekilde yÃ¶netebilirsiniz
- Secrets'larÄ± doÄŸru konfigÃ¼re edebilirsiniz  
- Production'da sorunsuz Ã§alÄ±ÅŸÄ±r
- GÃ¼venlik best practices'larÄ±nÄ± uygularsÄ±nÄ±z 